# Шаг 1: Берем легкий образ Node.js
FROM node:20-alpine

# Шаг 2: Указываем рабочую папку внутри контейнера
WORKDIR /app

# Шаг 3: Копируем файлы зависимостей
COPY package*.json ./

# Шаг 4: Устанавливаем зависимости
RUN npm install

# Шаг 5: Копируем весь остальной код проекта
COPY . .

# Шаг 6: Генерируем Prisma Client (обязательно для Prisma!)
# Это создаст типы и клиент на основе вашей schema.prisma
RUN npx prisma generate

# Шаг 7: Открываем порт, который используется в index.ts
EXPOSE 4000

# Шаг 8: Запускаем команду для разработки
# Она будет использовать nodemon, как указано в вашем package.json
CMD ["npm", "run", "dev"]